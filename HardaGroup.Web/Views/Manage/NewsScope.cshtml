@using HardaGroup.Utility;
@{
    Layout = "~/Views/Shared/_Admin.cshtml";
    ViewBag.Title = "媒体资讯模块管理";


}

<section class="content">
    <!-- Small boxes (Stat box) -->
    <div class="row">
        <div class="col-xs-12 col-is-12 col-sm-12 col-md-12">
            <div id="toolbar">
                <a id="btnAdd" class="btn btn-success">
                    <i class="glyphicon glyphicon-plus"></i> 新 增
                </a>
                <a id="btnEdit" class="btn btn-info">
                    <i class="glyphicon glyphicon-edit"></i> 修 改
                </a>
                <a id="btnDelete" class="btn btn-danger">
                    <i class="glyphicon glyphicon-remove"></i> 删 除
                </a>
                <a id="btnGlobalization" class="btn btn-primary">
                    <i class="glyphicon glyphicon-transfer"></i> 国际化
                </a>


            </div>
            <table id="table"></table>

        </div>

    </div>

</section>

<!--#region新增-->
<div class="curd-model modal fade" id="newsScopeadd" role="dialog"
     data-backdrop="static" aria-hidden="true">
    <div class="modal-dialog mediu-modal">
        <div class="modal-content mediu-modal-content">
            <div id="divAddContainer"></div>
        </div>
    </div>

</div>
<!--#endregion 修改-->
<!--#region修改-->
<div class="curd-model modal fade" id="newsScopeedit" role="dialog"
     data-backdrop="static" aria-hidden="true">
    <div class="modal-dialog mediu-modal">
        <div class="modal-content mediu-modal-content">
            <div id="divEditContainer"></div>
        </div>
    </div>

</div>

<!--#region国际化-->
<div class="curd-model modal fade" id="newsScopeGlobalization" role="dialog"
     data-backdrop="static" aria-hidden="true">
    <div class="modal-dialog mediu-modal">
        <div class="modal-content mediu-modal-content">
            <div id="divGlobalizationContainer"></div>
        </div>
    </div>

</div>


<!--Script要放在HTML标签后，才能将值绑定到标签-->
<script type="text/javascript">
    $(document).ready(function () {
        InitTable();
        InitToolBarButton();
        InitModalEvent();
    });
    function InitTable()
    {
        $('#table').bootstrapTable({
            height:500,
            method: 'post',                 //The method type to request remote data.
            url: '/Press/GetScopePageData',
            dataType: "json",               //The type of data that you are expecting back from the server.
            contentType:'application/json',
            pagination: true,               //True to show a pagination toolbar on table bottom.
            pageSize: 10,                   //初始化每页显示几条
            pageNumber:1,                   //初始化在第几页
            pageList: [10,25,50,100,200,'All'],
            sidePagination: "server",       //服务端请求
            idField:'Id',
            queryParams: ConstructQueryParams,
            //queryParamsType: "limit",
            locale: 'zh-CN',
            paginationVAlign: 'bottom',  //分页条显示在顶部
            clickToSelect: true,     //单击行选中数据
            toolbar: '#toolbar',
            showRefresh: true,
            showColumns: true,
            showToggle: true,
            showExport: true, //数据导出
            exportDataType: 'basic', // 'basic', 'all', 'selected'.
            exportTypes: ['excel'],
            filterControl: true,   //显示过滤
            filterShowClear: true,  //显示清空过滤按钮
            columns: [{
                checkbox: true
            },
            {
                field: 'Id',
                title: 'Id',
                visible:false,
            },
            {
                field: 'TypeCode',
                title: '新闻模块代码',
                filterControl: "input",
                sortable: true

            },
            {
                field: 'TypeName',
                title: '新闻模块名称',
                filterControl: "input",
                sortable: true

            },
            {
                field: 'Sequence',
                title: '顺序',
                sortable: true,
                width:'10%'
            }
            ]
        });
    }
    function ConstructQueryParams(param)
    {
        var filterObj = {};
        if (param.filter != null) {
            filterObj = JSON.parse(param.filter);
        }

        var params = {
            limit: param.limit, //页面大小
            offset:param.offset,//偏移数量
            page: param.offset / param.limit, //页码
            TypeCode: filterObj.TypeCode == null ? "" : filterObj.TypeCode,
            TypeName: filterObj.TypeName == null ? "" : filterObj.TypeName
        };
        return params;
    }

    function InitModalEvent() {
        $('#newsScopeadd').on('show.bs.modal', function () {
            //打开事件
        });

        $('#newsScopeadd').on('hide.bs.modal', function () {
            // 关闭事件
            $("#divAddContainer").html("");

        })

        $('#newsScopeedit').on('show.bs.modal', function () {
            //打开事件
        });

        $('#newsScopeedit').on('hide.bs.modal', function () {
            // 关闭事件
            $("#divEditContainer").html("");

        }); 
        $('#newsScopeGlobalization').on('show.bs.modal', function () {
            //打开事件
        });

        $('#newsScopeGlobalization').on('hide.bs.modal', function () {
            // 关闭事件
            $("#divGlobalizationContainer").html("");

        });

    }

    function CloseAddScreen() {
        $('#newsScopeadd').modal('hide');

    }
    function CloseEditScreen() {
        $('#newsScopeedit').modal('hide');

    }
    function CloseGlobalizationScreen() {
        $('#newsScopeGlobalization').modal('hide');

    }

    function InitToolBarButton()
    {
        document.onkeydown = function (e) {
            var ev = document.all ? window.event : e;
            if (ev.keyCode == 13) {

                RefreshTable();
            }
        };


        $("#btnAdd").click(function(){
            $('#newsScopeadd').modal('show');
            $("#divAddContainer").load("/Press/AddScope");
        });

        $("#btnEdit").click(function () {

            var selections = $('#table').bootstrapTable('getSelections');
            if (selections.length == 0) {
                layer.alert("请选择要将要修改的数据", {
                    skin: 'layui-layer-molv'
                            , closeBtn: 0
                            , shift: 5 //动画类型
                });
                return;
            } else if (selections.length != 1)
            {
                layer.alert("只能选择一条数据进行修改", {
                    skin: 'layui-layer-molv'
                            , closeBtn: 0
                            , shift: 5 //动画类型
                });
                return;
            }

            var id = selections[0].Id;
            $('#newsScopeedit').modal('show');
            $("#divEditContainer").load("/Press/EditScope?id=" + id);

        });

        $("#btnGlobalization").click(function () {

            var selections = $('#table').bootstrapTable('getSelections');
            if (selections.length == 0) {
                layer.alert("请选择要将要国际化的数据", {
                    skin: 'layui-layer-molv'
                            , closeBtn: 0
                            , shift: 5 //动画类型
                });
                return;
            } else if (selections.length != 1) {
                layer.alert("只能选择一条数据进行国际化操作", {
                    skin: 'layui-layer-molv'
                            , closeBtn: 0
                            , shift: 5 //动画类型
                });
                return;
            }

            var id = selections[0].Id;
            $('#newsScopeGlobalization').modal('show');
            $("#divGlobalizationContainer").load("/Press/GlobalizationNewsScope?id=" + id);

        });

        $("#btnDelete").click(function(){
            var selections = $('#table').bootstrapTable('getSelections');
            if(selections.length == 0)
            {
                layer.alert("请选择要将要删除的数据", {
                    skin: 'layui-layer-molv'
                            ,closeBtn: 0
                            ,shift: 5 //动画类型
                });
                return ;
            }
            var newsScopeIds =[];
            for(var i=0;i<selections.length;i++)
            {
                var id = selections[i].Id;
                newsScopeIds.push(id);
            }
            //delete records
            var jsonContactId = JSON.stringify(newsScopeIds);
            $.ajax({
                type: "post",//使用get方法访问后台
                dataType: "json",//返回json格式的数据
                url: "/Press/BachDeleteScopeById",
                data: jsonContactId,
                async:false,
                success: function(message){
                    if(message.Success)
                    {
                        RefreshTable();
                    }else{
                        layer.alert(message.Content, {
                            skin: 'layui-layer-molv'
                            ,closeBtn: 0
                            ,shift: 5 //动画类型
                        });
                    }

                }
            });
        });
    }

    function RefreshTable()
    {
        $('#table').bootstrapTable('refresh');

    }
</script>
